
/*
 * Styles for the Table of Contents (TOC) plugin.
 */
.toc-container {
    position: fixed;
    top: 6rem;
    bottom: 2rem;
    left: 20px;
    width: 240px;
    
    display: none;
    flex-direction: column;
    
    padding: 1rem 0;
    z-index: 50;
    border-right: 1px solid var(--border-color);
    
    /* کانتینر اصلی اسکرول نمی‌شود */
    overflow: hidden;
    
    transition: top 0.3s ease, bottom 0.3s ease;
}

.toc-title {
    font-size: 0.9rem;
    font-weight: 700;
    margin-top: 0;
    margin-bottom: 0.75rem;
    color: var(--text-color-strong);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    flex-shrink: 0;
    padding-right: 1rem;
}

/* 
 * استایل لیست اصلی که اسکرول می‌شود 
 */
.toc-container > ul {
    list-style: none;
    padding: 0;
    /* حذف مارجین‌ها برای جلوگیری از تداخل در محاسبه ارتفاع */
    margin: 0;
    
    flex-grow: 1;
    overflow-y: auto;
    
    padding-right: 1rem;
    padding-left: 0.5rem;
    
    /* فضای اضافه پایین برای راحتی اسکرول */
    padding-bottom: 2rem;
    
    scrollbar-width: thin;
    scrollbar-color: var(--border-color) transparent;
    overscroll-behavior: contain;
}

.toc-container li {
    /* حذف مارجین آیتم‌ها، فاصله با پدینگ لینک مدیریت می‌شود */
    margin: 0;
}

.toc-item-wrapper {
    display: flex;
    align-items: center;
    width: 100%;
    margin-bottom: 0.25rem;
}

.toc-toggle {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    margin-left: 0.5rem;
    color: var(--text-color);
    line-height: 1;
    flex-shrink: 0;
}

.toc-toggle-icon {
    display: inline-block;
    transition: transform 0.2s ease-in-out;
    font-weight: bold;
}

.toc-item--parent.is-open .toc-toggle-icon {
    transform: rotate(-90deg);
}

.toc-container a {
    display: block;
    color: var(--text-color);
    text-decoration: none;
    font-size: 0.875rem;
    padding: 0.3rem 0.5rem;
    border-radius: 4px;
    transition: color 0.2s, background-color 0.2s;
    
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;

    flex-grow: 1;
    min-width: 0;
}

.toc-container a:hover {
    background-color: var(--border-color);
}

.toc-container a.active {
    color: var(--primary-color);
    background-color: hsla(var(--primary-color-hsl, 158, 64%, 67%), 0.1);
    font-weight: 600;
}

/* 
 * انیمیشن گرید برای زیرمنوها
 */
.toc-sub-wrapper {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 0.3s ease-out;
}

.toc-item--parent.is-open > .toc-sub-wrapper {
    grid-template-rows: 1fr;
}

/* استایل لیست داخلی */
.toc-sub-wrapper > ul {
    list-style: none;
    margin: 0;
    padding: 0;
    padding-right: 1.25rem;
    
    /* این دو خط برای انیمیشن گرید حیاتی هستند */
    overflow: hidden;
    min-height: 0;
}

/* --- تنظیمات نمایش در دسکتاپ --- */
@media (min-width: 1201px) {
    body.toc-active .toc-container {
        display: flex;
    }

    body.toc-active .content {
        padding-left: calc(240px + 20px + 1.5rem);
    }
    
    body.toc-active .prose {
        max-width: 960px;
    }
}

/* --- یکپارچه‌سازی با نوار ناوبری --- */
body.shirazeh-navbar-active .toc-container {
  top: calc(var(--navbar-height, 64px) + 2rem);
}

body.shirazeh-navbar-active.navbar-scrolled .toc-container {
  top: calc(var(--navbar-height-scrolled, 56px) + 2rem);
}
