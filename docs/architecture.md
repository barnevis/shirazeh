# معماری پروژه

این سند یک نمای کلی از ساختار فنی و معماری PWiki ارائه می‌دهد. این اطلاعات برای توسعه‌دهندگانی که قصد مشارکت در پروژه را دارند یا کاربرانی که علاقه‌مند به درک نحوه کارکرد آن هستند، مفید است.

## اصول طراحی

PWiki بر پایه چند اصل کلیدی طراحی شده است:

-   **بدون فرآیند ساخت (Zero-Build):** تمام کدها (جاوااسکریپت، CSS و HTML) به صورت خالص و بدون نیاز به کامپایلر یا باندلر نوشته شده‌اند.
-   **سمت کاربر (Client-Side):** تمام منطق برنامه، از مسیریابی گرفته تا رندر کردن مارک‌داون، در مرورگر کاربر اجرا می‌شود.
-   **ماژولار بودن:** کدها به ماژول‌های کوچک و مستقل تقسیم شده‌اند که هر کدام یک وظیفه مشخص دارند (اصل Single Responsibility).
-   **تنظیمات محور (Configuration-Driven):** رفتار اصلی برنامه از طریق یک فایل پیکربندی مرکزی کنترل می‌شود.

## ساختار پوشه‌ها

```
pwiki/
├── config/              # تمام فایل‌های پیکربندی کاربر
│   ├── config.js
│   └── sidebar.md
├── docs/                # مستندات پروژه
├── src/                 # کدهای اصلی و هسته برنامه
│   ├── core/            # ماژول‌های اصلی (مغز برنامه)
│   │   ├── app.js
│   │   ├── configManager.js
│   │   ├── domRenderer.js
│   │   ├── fileReader.js
│   │   ├── markdownParser.js
│   │   ├── router.js
│   │   └── sidebar.js
│   ├── styles/          # فایل‌های CSS
│   └── index.js         # نقطه ورود اصلی برنامه
├── *.md                 # فایل‌های نمونه محتوا
└── index.html           # فایل اصلی HTML
```

## نقش ماژول‌های اصلی (`src/core/`)

-   **`index.js`:** نقطه شروع برنامه. وظیفه آن بارگذاری تنظیمات و مقداردهی اولیه کلاس `App` است.
-   **`app.js`:** ارکستراتور اصلی برنامه. تمام ماژول‌ها را هماهنگ کرده و چرخه حیات برنامه را مدیریت می‌کند (شروع، بارگذاری صفحه، مدیریت خطا).
-   **`configManager.js`:** مسئول بارگذاری تنظیمات پیش‌فرض و ادغام آن‌ها با تنظیمات کاربر (`config.js`). این ماژول تضمین می‌کند که برنامه همیشه یک پیکربندی معتبر در اختیار دارد.
-   **`router.js`:** مسیریاب سمت کاربر. تغییرات URL hash (مانند `/#/about`) را شناسایی کرده و به کلاس `App` اطلاع می‌دهد که کدام صفحه باید بارگذاری شود.
-   **`sidebar.js`:** مسئولیت کامل منوی کناری را بر عهده دارد؛ از جمله بارگذاری محتوا از فایل `sidebar.md`، مدیریت زیرمنوها و هایلایت کردن لینک فعال.
-   **`fileReader.js`:** یک ماژول ساده برای واکشی (fetch) محتوای فایل‌های مارک‌داون از سرور.
-   **`markdownParser.js`:** یک پوشش (wrapper) برای کتابخانه `marked.js` که وظیفه تبدیل رشته مارک‌داون به HTML را دارد.
-   **`domRenderer.js`:** تنها ماژولی که مستقیماً با DOM در ارتباط است. وظیفه آن نمایش پیام‌های بارگذاری، خطا و رندر کردن محتوای نهایی در صفحه است.

## جریان اجرای برنامه

یک نمودار متنی ساده از نحوه اجرای برنامه:

```
[کاربر صفحه را باز می‌کند]
       |
       v
1. index.html بارگذاری می‌شود
       |
       v
2. index.js اجرا می‌شود
       |
       v
3. configManager.js تنظیمات کاربر را با پیش‌فرض ادغام می‌کند
       |
       v
4. app.js با تنظیمات نهایی مقداردهی اولیه می‌شود
       |
       v
5. app.js ماژول‌های Sidebar و Router را مقداردهی می‌کند
       |
       v
6. Sidebar محتوای منو را از sidebar.md بارگذاری و رندر می‌کند
       |
       v
7. Router مسیر فعلی را از URL می‌خواند (مثلاً /#/)
       |
       v
8. Router به App می‌گوید که صفحه پیش‌فرض (README.md) را بارگذاری کند
       |
       v
9. App از fileReader برای خواندن README.md استفاده می‌کند
       |
       v
10. App محتوای خوانده شده را به markdownParser می‌دهد تا به HTML تبدیل شود
       |
       v
11. App از domRenderer برای نمایش HTML نهایی در صفحه استفاده می‌کند
```

این جریان برای هر بار تغییر مسیر (کلیک روی لینک‌های منو) از مرحله ۷ به بعد تکرار می‌شود.
