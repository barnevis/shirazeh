# معماری پروژه

این سند یک نمای کلی از ساختار فنی و معماری شیرازه ارائه می‌دهد. این اطلاعات برای توسعه‌دهندگانی که قصد مشارکت در پروژه را دارند یا کاربرانی که علاقه‌مند به درک نحوه کارکرد آن هستند، مفید است.

## اصول طراحی

شیرازه بر پایه چند اصل کلیدی طراحی شده است:

-   **بدون فرآیند ساخت (Zero-Build):** تمام کدها (جاوااسکریپت، CSS و HTML) به صورت خالص و بدون نیاز به کامپایلر یا باندلر نوشته شده‌اند.
-   **سمت کاربر (Client-Side):** تمام منطق برنامه، از مسیریابی گرفته تا رندر کردن مارک‌داون، در مرورگر کاربر اجرا می‌شود.
-   **ماژولار بودن:** کدها به ماژول‌های کوچک و مستقل تقسیم شده‌اند که هر کدام یک وظیفه مشخص دارند (اصل Single Responsibility).
-   **تنظیمات محور (Configuration-Driven):** رفتار اصلی برنامه از طریق یک فایل پیکربندی مرکزی کنترل می‌شود.

## ساختار پوشه‌ها

```
shirazeh/
├── config/              # تمام فایل‌های پیکربندی کاربر
│   ├── config.js
│   └── sidebar.md
├── docs/                # مستندات پروژه
├── src/                 # کدهای اصلی و هسته برنامه
│   ├── core/            # ماژول‌های اصلی (مغز برنامه)
│   │   ├── app.js
│   │   ├── configManager.js
│   │   ├── domRenderer.js
│   │   ├── fileReader.js
│   │   ├── markdownParser.js
│   │   ├── router.js
│   │   ├── sidebar.js
│   │   └── themeManager.js # ماژول جدید مدیریت تم
│   ├── styles/          # فایل‌های CSS
│   │   ├── themes/        # پوشه جدید برای تم‌ها
│   │   │   ├── dark.css
│   │   │   └── light.css
│   │   └── ...
│   └── index.js         # نقطه ورود اصلی برنامه
├── *.md                 # فایل‌های نمونه محتوا
└── index.html           # فایل ورودی HTML که تنها شامل یک نگه‌دارنده (`<div id="app">`) برای برنامه است
```

## نقش ماژول‌های اصلی (`src/core/`)

-   **`index.js`:** نقطه شروع برنامه. وظیفه آن بارگذاری تنظیمات و مقداردهی اولیه کلاس `App` است.
-   **`app.js`:** ارکستراتور اصلی برنامه. این ماژول ساختار اصلی HTML را ایجاد کرده، تمام ماژول‌های دیگر را هماهنگ و چرخه حیات برنامه را مدیریت می‌کند.
-   **`configManager.js`:** مسئول بارگذاری تنظیمات پیش‌فرض و ادغام آن‌ها با تنظیمات کاربر (`config.js`).
-   **`router.js`:** مسیریاب سمت کاربر که تغییرات URL hash را مدیریت می‌کند.
-   **`sidebar.js`:** مسئولیت کامل منوی کناری را بر عهده دارد (بارگذاری محتوا، مدیریت زیرمنوها و هایلایت کردن لینک فعال).
-   **`themeManager.js` (جدید):** تمام منطق مربوط به تم (روشن/تاریک) را مدیریت می‌کند. این ماژول مسئول تشخیص تم سیستم، اعمال تم انتخابی، ذخیره انتخاب کاربر و کنترل دکمه جابجایی تم است.
-   **`fileReader.js`:** یک ماژول ساده برای واکشی (fetch) محتوای فایل‌های مارک‌داون.
-   **`markdownParser.js`:** یک پوشش (wrapper) برای کتابخانه `marked.js` برای تبدیل مارک‌داون به HTML.
-   **`domRenderer.js`:** تنها ماژولی که مستقیماً با DOM در ارتباط است و وظیفه رندر محتوا، خطا و پیام بارگذاری را دارد.

## جریان اجرای برنامه

یک نمودار متنی ساده از نحوه اجرای برنامه:

```
[کاربر صفحه را باز می‌کند]
       |
       v
1. index.html بارگذاری می‌شود
       |
       v
2. index.js اجرا می‌شود
       |
       v
3. configManager.js تنظیمات را ادغام می‌کند
       |
       v
4. app.js با تنظیمات نهایی مقداردهی اولیه می‌شود
       |
       v
5. app.js ساختار اصلی HTML را در DOM ایجاد می‌کند
       |
       v
6. themeManager.js تم (روشن/تاریک) را بر اساس اولویت (حافظه > کانفیگ > سیستم) اعمال می‌کند و دکمه جابجایی را می‌سازد
       |
       v
7. app.js ماژول‌های Sidebar و Router را مقداردهی اولیه می‌کند
       |
       v
8. Sidebar محتوای منو را از sidebar.md بارگذاری و رندر می‌کند
       |
       v
9. Router مسیر فعلی را از URL می‌خواند
       |
       v
10. Router به App می‌گوید که صفحه مربوطه را بارگذاری کند
       |
       v
11. App از fileReader برای خواندن فایل مارک‌داون استفاده می‌کند
       |
       v
12. App محتوای خوانده شده را به markdownParser می‌دهد تا به HTML تبدیل شود
       |
       v
13. App از domRenderer برای نمایش HTML نهایی در صفحه استفاده می‌کند
```

این جریان برای هر بار تغییر مسیر (کلیک روی لینک‌های منو) از مرحله ۹ به بعد تکرار می‌شود.
