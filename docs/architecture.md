# معماری پروژه

این سند یک نمای کلی از ساختار فنی و معماری شیرازه ارائه می‌دهد. این اطلاعات برای توسعه‌دهندگانی که قصد مشارکت در پروژه را دارند یا کاربرانی که علاقه‌مند به درک نحوه کارکرد آن هستند، مفید است.

## اصول طراحی

شیرازه بر پایه چند اصل کلیدی طراحی شده است:

-   **بدون فرآیند ساخت (Zero-Build):** تمام کدها (جاوااسکریپت، CSS و HTML) به صورت خالص و بدون نیاز به کامپایلر یا باندلر نوشته شده‌اند.
-   **سمت کاربر (Client-Side):** تمام منطق برنامه، از مسیریابی گرفته تا رندر کردن مارک‌داون، در مرورگر کاربر اجرا می‌شود.
-   **ماژولار بودن:** کدها به ماژول‌های کوچک و مستقل تقسیم شده‌اند که هر کدام یک وظیفه مشخص دارند (اصل Single Responsibility).
-   **تنظیمات محور (Configuration-Driven):** رفتار اصلی برنامه از طریق یک فایل پیکربندی مرکزی کنترل می‌شود.

## پشته فناوری (Technology Stack)

شیرازه با تمرکز بر سادگی و کارایی، از یک پشته فناوری سبک و مدرن استفاده می‌کند:

-   **زبان‌های اصلی:** HTML5، CSS3 و جاوااسکریپت خالص (ES6+ Modules).
-   **بدون فریم‌ورک:** پروژه کاملاً با جاوااسکریپت خالص (Vanilla JS) نوشته شده است تا حداکثر سرعت، حداقل وابستگی و شفافیت کامل را فراهم کند.
-   **مفسر مارک‌داون:** کتابخانه قدرتمند `markdown-it` به عنوان هسته مفسر پیش‌فرض (پارس‌نشان) استفاده می‌شود که با افزونه‌های سفارشی برای زبان فارسی غنی شده است.
-   **بدون ابزار ساخت:** هیچ نیازی به ابزارهای پیچیده‌ای مانند Webpack, Rollup یا Vite نیست. کدها به صورت مستقیم و بدون هیچ فرآیندی در مرورگر اجرا می‌شوند.
-   **هاستینگ:** به دلیل ماهیت کاملاً استاتیک، شیرازه روی هر سرویس میزبانی فایل استاتیک (مانند GitHub Pages, Netlify, Vercel) یا حتی یک سرور ساده قابل اجراست.

## ساختار پوشه‌ها

```
shirazeh/
├── config/              # تمام فایل‌های پیکربندی کاربر
├── docs/                # مستندات پروژه
├── src/                 # کدهای اصلی و هسته برنامه
│   ├── core/            # ماژول‌های اصلی (مغز برنامه)
│   │   ├── app.js
│   │   ├── configManager.js
│   │   ├── domRenderer.js
│   │   ├── fileReader.js
│   │   ├── layoutManager.js
│   │   ├── pageManager.js
│   │   ├── parserManager.js
│   │   ├── pluginManager.js
│   │   ├── router.js
│   │   ├── sidebar.js
│   │   ├── themeManager.js
│   │   ├── titleManager.js
│   │   ├── widgetManager.js   # ماژول جدید مدیر ویجت‌ها
│   │   └── utils.js
│   ├── parsers/         # مفسرهای مارک‌داون داخلی
│   ├── plugins/         # افزونه‌های داخلی
│   ├── styles/          # فایل‌های CSS
│   └── index.js         # نقطه ورود اصلی برنامه
├── *.md                 # فایل‌های نمونه محتوا
└── index.html           # فایل ورودی HTML
```

## نقش ماژول‌های اصلی (`src/core/`)

-   **`index.js`:** نقطه شروع برنامه. وظیفه آن بارگذاری تنظیمات و مقداردهی اولیه کلاس `App` است.
-   **`app.js`:** **ارکستراتور اصلی برنامه.** مسئولیت اصلی آن هماهنگی و مقداردهی اولیه سایر ماژول‌هاست. این ماژول دیگر مستقیماً با DOM یا منطق بارگذاری صفحه درگیر نیست و این وظایف را به مدیران تخصصی واگذار می‌کند.
-   **`layoutManager.js`:** **مدیر چیدمان.** این ماژول جدید تمام وظایایف مربوط به ساختار DOM را بر عهده دارد. مسئولیت ساخت چیدمان اصلی، هدر سایدبار، دکمه‌ها و تنظیم Favicon با این ماژول است.
-   **`pageManager.js`:** **مدیر صفحه.** این ماژول جدید مسئولیت کامل چرخه حیات بارگذاری یک صفحه را بر عهده می‌گیرد. وظایف آن شامل واکشی محتوا (با `fileReader`)، بازنویسی لینک‌های محتوای خارجی، رندر محتوا (با `domRenderer`)، مدیریت خطای 404 و اطلاع‌رسانی به ماژول‌های دیگر (`titleManager`, `pluginManager`) است.
-   **`configManager.js`:** مسئول بارگذاری تنظیمات پیش‌فرض و ادغام آن‌ها با تنظیمات کاربر (`config.js`).
-   **`parserManager.js`:** مسئولیت بارگذاری، نمونه‌سازی و مدیریت مفسر مارک‌داون را بر عهده دارد.
-   **`pluginManager.js`:** چرخه حیات افزونه‌ها را مدیریت می‌کند (بارگذاری، اجرای هوک‌ها و...).
-   **`router.js`:** مسیریاب سمت کاربر که تغییرات URL hash را مدیریت کرده و `pageManager` را برای بارگذاری صفحه جدید فراخوانی می‌کند.
-   **`sidebar.js`:** مسئولیت کامل منوی کناری را بر عهده دارد.
-   **`themeManager.js`:** تمام منطق مربوط به تم (روشن/تاریک) و فونت‌ها را مدیریت می‌کند.
-   **`titleManager.js`:** مسئولیت کامل مدیریت عنوان تب مرورگر را بر عهده دارد.
-   **`widgetManager.js`:** **مدیر ویجت‌ها.** این ماژول مسئولیت ثبت و رندر کردن کامپوننت‌های کوچک UI (ویجت‌ها) در جایگاه‌های از پیش تعریف شده (اسلات‌ها) را بر عهده دارد.
-   **`fileReader.js`:** یک ماژول ساده برای واکشی (fetch) محتوای فایل‌ها.
-   **`domRenderer.js`:** تنها ماژولی که مستقیماً با DOM در ارتباط است و وظیفه رندر محتوا، خطا و پیام بارگذاری را دارد.
-   **`utils.js`:** یک ماژول کمکی شامل توابع مشترک که در سراسر برنامه استفاده می‌شوند.

## جریان اجرای برنامه

یک نمودار متنی ساده از نحوه اجرای برنامه:

```
[کاربر صفحه را باز می‌کند]
       |
       v
1. index.html بارگذاری می‌شود
       |
       v
2. index.js اجرا می‌شود
       |
       v
3. configManager.js تنظیمات را ادغام می‌کند
       |
       v
4. app.js با تنظیمات نهایی، تمام مدیران اصلی (Layout, Theme, Parser, Page, etc.) را مقداردهی اولیه می‌کند
       |
       v
5. layoutManager.js ساختار اصلی HTML (سایدبار، محتوا و اسلات‌های ویجت) را در DOM ایجاد می‌کند
       |
       v
6. themeManager.js تم (روشن/تاریک) و فونت‌ها را اعمال می‌کند
       |
       v
7. pluginManager.js تمام افزونه‌ها را بارگذاری و متد onInit آن‌ها را اجرا می‌کند
       |
       v
8. ویجت‌ها (مانند دکمه تم) خود را در widgetManager ثبت می‌کنند
       |
       v
9. widgetManager.js تمام ویجت‌های ثبت شده را در اسلات‌های مربوطه رندر می‌کند
       |
       v
10. sidebar.js محتوای منو را بارگذاری و رندر می‌کند
        |
        v
11. router.js مقداردهی اولیه شده و مسیر فعلی را می‌خواند
        |
        v
12. router.js به pageManager.js اطلاع می‌دهد که صفحه مربوطه را بارگذاری کند
        |
        v
13. pageManager.js:
    - پیام "در حال بارگذاری" را نمایش می‌دهد (توسط domRenderer)
    - محتوای فایل مارک‌داون را واکشی می‌کند (توسط fileReader)
    - محتوا را به parserManager می‌دهد تا به HTML تبدیل شود
    - HTML نهایی را نمایش می‌دهد (توسط domRenderer)
    - به titleManager اطلاع می‌دهد تا عنوان تب را به‌روزرسانی کند
    - به pluginManager اطلاع می‌دهد تا هوک onPageLoad را اجرا کند
    - لینک فعال در سایدبار را مشخص می‌کند
```

این جریان برای هر بار تغییر مسیر (کلیک روی لینک‌های منو) از مرحله ۱۱ به بعد تکرار می‌شود.