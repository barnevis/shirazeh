# افزونه خروجی صفحه (Page Exporter)

این افزونه یک ابزار قدرتمند برای کاربران فراهم می‌کند تا بتوانند محتوای صفحه فعلی را به فرمت‌های مختلفی مانند PDF، HTML یا Markdown خام دانلود کنند. این قابلیت برای به اشتراک‌گذاری، آرشیو کردن یا استفاده آفلاین از محتوا بسیار مفید است.

## ویژگی‌های اصلی

-   **فرمت‌های خروجی متعدد:** پشتیبانی از خروجی PDF، HTML مستقل و فایل Markdown خام.
-   **خروجی باکیفیت:**
    -   **PDF:** خروجی PDF تمام استایل‌ها، فونت‌های فارسی، رنگ‌آمیزی کدها و تصاویر را به دقت حفظ می‌کند.
    -   **HTML:** یک فایل HTML کاملاً مستقل (self-contained) با تمام استایل‌های CSS درون‌خطی ایجاد می‌کند که دقیقاً شبیه به صفحه وب اصلی است.
-   **رابط کاربری هوشمند:**
    -   اگر بیش از یک فرمت خروجی فعال باشد، با کلیک روی دکمه یک منوی بازشونده برای انتخاب فرمت نمایش داده می‌شود.
    -   اگر فقط یک فرمت فعال باشد، با کلیک روی دکمه، دانلود مستقیماً آغاز می‌شود.
-   **یکپارچگی کامل با سیستم ویجت:** می‌توانید دکمه دانلود را در هر یک از اسلات‌های تعریف‌شده (مانند نوار ناوبری، گوشه‌های صفحه و...) قرار دهید.
-   **استفاده در داخل محتوا:** با استفاده از سینتکس ساده `[download]` می‌توانید دکمه دانلود را در هر قسمتی از محتوای خود قرار دهید.
-   **کاملاً قابل پیکربندی:** شما می‌توانید فرمت‌های فعال، الگوی نام فایل خروجی، ظاهر دکمه و متن‌های UI را به سادگی از طریق `config.js` کنترل کنید.

## فعال‌سازی افزونه

برای فعال کردن این افزونه، مسیر آن را به لیست `plugins` در فایل `config.js` اضافه کنید:

```javascript
// in config/config.js
window.shirazeh = {
  // ...
  plugins: [
    'src/plugins/pageExporter/pageExporter.js'
  ],
  // ...
};
```

## پیکربندی

تمام تنظیمات این افزونه از طریق آبجکت `pageExporter` در فایل `config.js` انجام می‌شود.

```javascript
// in config/config.js
window.shirazeh = {
  // ...
  pageExporter: {
    enabled: true,
    widgetId: 'page-exporter',
    formats: ['pdf', 'html', 'md'],
    filename: '{{page-title}} - {{wiki-name}}',
    displayMode: 'icon',
    labels: {
      button: 'دانلود',
      downloadAs: 'دانلود به عنوان:',
      pdf: 'فایل PDF',
      html: 'فایل HTML',
      md: 'فایل Markdown',
      preparing: 'در حال آماده‌سازی...'
    }
  },
  // ...
};
```

### گزینه‌های پیکربندی

-   `enabled`: (`boolean`, پیش‌فرض: `true`) افزونه را فعال یا غیرفعال می‌کند.
-   `widgetId`: (`string`, پیش‌فرض: `'page-exporter'`) شناسه‌ای که برای ثبت ویجت در سیستم ویجت استفاده می‌شود. این شناسه باید با کلید تعریف‌شده در `widgets.slots` مطابقت داشته باشد.
-   `formats`: (`Array<string>`, پیش‌فرض: `['pdf', 'html', 'md']`) آرایه‌ای از فرمت‌های خروجی که می‌خواهید در دسترس باشند. ترتیب آیتم‌ها در این آرایه، ترتیب نمایش آن‌ها در منوی بازشونده را تعیین می‌کند. مقادیر ممکن: `'pdf'`, `'html'`, `'md'`.
-   `filename`: (`string`, پیش‌فرض: `'{{page-title}}'`) الگویی برای نام فایل دانلودی. شما می‌توانید از متغیرهای زیر استفاده کنید:
    -   `{{page-title}}`: عنوان صفحه فعلی.
    -   `{{wiki-name}}`: نام ویکی شما (از `appName`).
    -   `{{date}}`: تاریخ فعلی (به فرمت `YYYY-MM-DD`).
-   `displayMode`: (`string`, پیش‌فرض: `'icon'`) ظاهر دکمه را در حالت ویجت مشخص می‌کند:
    -   `'icon'`: یک دکمه گرد و کوچک فقط با آیکون (مانند دکمه تغییر تم).
    -   `'button'`: یک دکمه کامل با آیکون و متن.
-   `labels`: (`object`) به شما اجازه می‌دهد تمام متن‌های استفاده شده در رابط کاربری افزونه را شخصی‌سازی کنید.

### مدیریت موقعیت (از طریق سیستم ویجت)

برای تعیین موقعیت دکمه دانلود، باید یک ورودی برای `widgetId` این افزونه در بخش `widgets.slots` ایجاد کنید.

**مثال: قرار دادن دکمه دانلود در گوشه پایین-چپ صفحه**
```javascript
// in config.js
window.shirazeh = {
  // ...
  widgets: {
    enabled: true,
    slots: {
      'page-exporter': { desktop: 'dock-bottom-left', mobile: 'hide', priority: 100 },
      // ... سایر ویجت‌ها
    },
  },
  // ...
};
```
> برای اطلاعات کامل در مورد اسلات‌ها و سیاست‌های موبایل، به **[مستندات سیستم مدیریت ویجت‌ها](/docs/widgetSystem)** مراجعه کنید.

## استفاده در داخل محتوا

شما می‌توانید دکمه دانلود را در هر قسمتی از محتوای مارک‌داون خود با استفاده از سینتکس زیر قرار دهید:

```markdown
برای دریافت این راهنما به صورت آفلاین، می‌توانید آن را دانلود کنید:

[download]

---
## بخش بعدی

ادامه محتوای شما...
```

این سینتکس به صورت خودکار با یک دکمه کامل (شامل آیکون و متن) جایگزین خواهد شد. متن داخل براکت به عنوان متن دکمه استفاده می‌شود. اگر خالی باشد، از متن پیش‌فرض در پیکربندی استفاده خواهد شد.

**مثال با متن سفارشی:**
```markdown
[دانلود این راهنما به صورت PDF]
```