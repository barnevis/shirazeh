# راهنمای توسعه افزونه

سیستم افزونه شیرازه به توسعه‌دهندگان اجازه می‌دهد تا قابلیت‌های جدیدی را بدون نیاز به دستکاری کدهای اصلی به برنامه اضافه کنند. این سیستم بر پایه یک معماری ماژولار و رویداد-محور (event-driven) ساخته شده است که به افزونه‌ها اجازه می‌دهد به رویدادهای کلیدی در چرخه حیات برنامه گوش دهند و واکنش نشان دهند.

## فعال‌سازی یک افزونه

برای فعال کردن یک افزونه، کافیست مسیر فایل جاوااسکریپت آن را به آرایه `plugins` در فایل `config/config.js` اضافه کنید.

```javascript
// in config/config.js
window.shirazeh = {
  // ... سایر تنظیمات
  plugins: [
    'src/plugins/toc.js',
    'src/plugins/githubCorner/githubCorner.js',
    'src/plugins/code-copy/code-copy.js',
    'src/plugins/headingAnchor/headingAnchor.js', // افزونه جدید شما
  ],
  // ...
};
```

## افزونه‌های داخلی

شیرازه با چند افزونه کاربردی ارائه می‌شود که می‌توانید آن‌ها را فعال یا غیرفعال کنید.

### افزونه نوار ناوبری (Navbar)
این افزونه یک نوار ناوبری (منوی اصلی) زیبا، واکنش‌گرا و کاملاً قابل پیکربندی در بالای صفحه اضافه می‌کند.
برای اطلاعات کامل به [مستندات افزونه Navbar](/docs/plugins/navbar) مراجعه کنید.

### افزونه فهرست مطالب (Table of Contents)
این افزونه به صورت خودکار یک پنل ناوبری شناور در سمت چپ صفحه برای مقالات طولانی ایجاد می‌کند. 
برای اطلاعات بیشتر به [مستندات افزونه TOC](/docs/plugins/toc) مراجعه کنید.

### افزونه لینک گیت‌هاب (GitHub Corner)
این افزونه یک لینک زیبا به شکل "روبان" در گوشه صفحه برای ارجاع به مخزن گیت‌هاب پروژه شما اضافه می‌کند. 
برای اطلاعات کامل به [مستندات افزونه GitHub Corner](/docs/plugins/githubCorner) مراجعه کنید.

### افزونه رونوشت کد (Code Copy)
این افزونه یک دکمه «رونوشت» به تمام بلوک‌های کد اضافه می‌کند تا کاربران بتوانند به راحتی قطعه کدها را در کلیپ‌بورد خود رونوشت کنند. 
برای اطلاعات بیشتر به [مستندات افزونه رونوشت کد](/docs/plugins/codeCopy) مراجعه کنید.

### افزونه لینک عنوان‌ها (Heading Anchor)
این افزونه یک آیکون قابل کلیک در کنار عنوان‌های صفحه (h2, h3, ...) اضافه می‌کند که به کاربران اجازه می‌دهد لینک مستقیم به آن بخش را کپی کنند. 
برای اطلاعات بیشتر به [مستندات افزونه لینک عنوان‌ها](/docs/plugins/headingAnchor) مراجعه کنید.

### افزونه رنگ‌آمیزی کد (Syntax Highlighting)
این افزونه با استفاده از کتابخانه قدرتمند Highlight.js، بلوک‌های کد شما را به صورت خودکار رنگ‌آمیزی می‌کند و قابلیت‌های پیشرفته‌ای مانند شماره خط و هایلایت خطوط خاص را فراهم می‌آورد. 
برای اطلاعات کامل به [مستندات افزونه رنگ‌آمیزی کد](/docs/plugins/highlight) مراجعه کنید.

### افزونه تنظیم اندازه تصویر (Image Sizer)
این افزونه به شما اجازه می‌دهد تا به سادگی اندازه (عرض و ارتفاع) تصاویر را مستقیماً از طریق سینتکس مارک‌داون کنترل کنید.
برای اطلاعات کامل به [مستندات افزونه Image Sizer](/docs/plugins/imageSizer) مراجعه کنید.

## معماری یک افزونه

هر افزونه در شیرازه یک **کلاس جاوااسکریپت** است که به صورت `export default` صادر می‌شود. این کلاس می‌تواند شامل متدهای خاصی به نام **هوک‌های چرخه حیات (Lifecycle Hooks)** باشد که توسط شیرازه در زمان‌های مشخصی فراخوانی می‌شوند.

### هوک‌های چرخه حیات (Lifecycle Hooks)

این متدها اختیاری هستند. افزونه شما فقط باید متدهایی را پیاده‌سازی کند که به آن‌ها نیاز دارد.

#### `onInit(app)`
این متد **یک بار**، درست پس از بارگذاری و نمونه‌سازی افزونه، فراخوانی می‌شود. این بهترین مکان برای انجام تنظیمات اولیه، بارگذاری استایل‌ها یا ثبت هرگونه وضعیت اولیه است.

-   **پارامتر `app`**: یک ارجاع به نمونه اصلی کلاس `App` شیرازه است. این پارامتر بسیار قدرتمند است و به شما اجازه می‌دهد به تنظیمات برنامه (`app.config`) و متدهای کمکی مانند `app.resolvePath()` دسترسی داشته باشید.

#### `onPageLoad(contentElement)`
این متد **هر بار** که یک صفحه جدید با موفقیت بارگذاری و رندر می‌شود، فراخوانی می‌گردد (این شامل صفحات خطا مانند 404 نیز می‌شود). این هوک برای دستکاری محتوای رندر شده (مثلاً برای اضافه کردن دکمه‌ها، هایلایت کردن کد، یا اجرای اسکریپت‌های خاص محتوا) ایده‌آل است.

-   **پارامتر `contentElement`**: یک ارجاع به المان DOM است که محتوای HTML صفحه در آن قرار گرفته است.

#### `onDestroy()`
این متد برای استفاده در آینده در نظر گرفته شده است و زمانی فراخوانی خواهد شد که برنامه در حال بسته شدن است. می‌توانید از آن برای پاک‌سازی منابع (مانند حذف event listenerها) استفاده کنید.

## ساخت یک افزونه نمونه

بیایید یک افزونه بسیار ساده بسازیم که هنگام بارگذاری هر صفحه، یک پیام در کنسول مرورگر چاپ می‌کند.

### ۱. نوشتن کد جاوااسکریپت (`src/plugins/hello.js`)

یک فایل جدید به نام `hello.js` در پوشه `src/plugins/` ایجاد کنید و کد زیر را در آن قرار دهید:

```javascript
/**
 * @file یک افزونه نمونه برای نمایش پیام در کنسول
 */
export default class HelloPlugin {
    onInit(app) {
        // این پیام فقط یک بار هنگام شروع برنامه نمایش داده می‌شود
        console.log(`HelloPlugin: Initialized! App name is "${app.config.appName}".`);
    }

    onPageLoad(contentElement) {
        // این پیام با هر بار بارگذاری صفحه جدید نمایش داده می‌شود
        const h1 = contentElement.querySelector('h1');
        const pageTitle = h1 ? h1.textContent : 'Unknown Page';
        console.log(`HelloPlugin: Page loaded - "${pageTitle}"`);
    }
}
```

### ۲. فعال‌سازی افزونه

در نهایت، افزونه جدید را در `config/config.js` فعال می‌کنیم:

```javascript
// in config/config.js
window.shirazeh = {
  // ...
  plugins: [
    'src/plugins/hello.js' // <-- این خط را اضافه کنید
  ],
  // ...
};
```

حالا با رفرش کردن صفحه و باز کردن کنسول مرورگر، باید پیام‌های این افزونه را مشاهده کنید. این مثال ساده، نحوه کارکرد هوک‌های چرخه حیات را به خوبی نشان می‌دهد.

## ابزارهای کمکی برای افزونه‌ها

### `injectCSS(path)`
این تابع کمکی که از `pluginManager` قابل `import` است، به شما اجازه می‌دهد یک فایل CSS را به صورت پویا به `<head>` صفحه اضافه کنید.

-   **نحوه استفاده:**
    ```javascript
    import { injectCSS } from '../core/pluginManager.js';

    // ... در متد onInit
    const cssPath = app.resolvePath('path/to/your/plugin.css');
    injectCSS(cssPath);
    ```
-   **نکته مهم:** همیشه از `app.resolvePath()` برای ساخت مسیر فایل CSS استفاده کنید تا مطمئن شوید مسیر نسبت به `basePath` پروژه به درستی محاسبه می‌شود.

### دسترسی به نمونه `App`
همانطور که گفته شد، پارامتر `app` در `onInit` دسترسی کاملی به هسته برنامه به شما می‌دهد. برخی از کاربردهای رایج آن عبارتند از:
-   **خواندن تنظیمات:** `app.config.appName`
-   **حل کردن مسیرها:** `app.resolvePath('some/file.md')`
-   **دسترسی به سایر اجزا (در آینده):** `app.router`, `app.sidebar`

این ابزارها به شما قدرت زیادی برای ساخت افزونه‌های پیچیده و یکپارچه با شیرازه می‌دهند.
